<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" type="text/css" href="index.css">
</head>
<body>

  <div id="colorful-text" data-id='colorful-text'>
    <pre>Type Message Here</pre>
  </div>

  <div data-id='controls' id='controls'>
    <textarea focus placeholder='Type Message Here'></textarea>

    <div id='font-styles-wrapper'>
      <div id='font-size-range-wrapper'>
        <label for='font-size-range'>Font size:</label>
        <input id='font-size-range' data-id='font-size-range' value='135' type='range' min='30' max='300'>
      </div>

      <select id='font-family-selector' data-id='font-family-selector' placeholder='Text Style'>
        <option value='Copperplate,"Copperplate Gothic Light"' selected='selected'>Copperplate</option>
        <option value='Cursive'>Cursive</option>
        <option value='diploma_text'>Diploma Text</option>
        <option value='Fantasy'>Fantasy</option>
        <option value='Serif'>Serif</option>
        <option value="Courier New">Courier New</option>
        <option value='Brush Script MT'>Brush Script MT</option>
        <option value='-webkit-pictograph'>pictograph</option>
        <option value='Monospace'>Monospace</option>
        <option value='Sans-Serif'>Sans-Serif</option>
      </select>
    </div>

    <div id='output-html-wrapper'>
      <label for='output-html'> Copy URL: </label>

      <p id='output-html' data-id='output-html'></p>
    </div>

    <p>Use -> <a href='https://bitly.com/'>bitly.com</a> <- to shorten url and disguise message that will be displayed</p>
  </div>

  <script>

    window.onload = function() {

      window.default_color_sequence = "red,orange,yellow,green,blue,indigo,red,orange,yellow,green,blue,indigo"

      function getColors(){
        return window.color_sequence.replace(/ /g, '');
      }

      function setURI(message, font_size=undefined, font_family=undefined, colors=window.default_color_sequence){
        if(message === ''){
          document.querySelector("[data-id='output-html']").innerHTML = '';
        }
        else{

          // only add a color string if color is not default
          let color_sequence_for_uri = ''
          if(colors != window.default_color_sequence){
            color_sequence_for_uri = `<wbr>&color_sequence=${colors}`
          }

          document.querySelector("[data-id='output-html']").innerHTML = document.location +
            `?<wbr>font-size=${font_size}` + color_sequence_for_uri + `<wbr>&font-family=${font_family.replace(/ /g, '%20')}` + `<wbr>&message=${encodeURI(message)}`;
        }
      }

      function getText() {
        return document.querySelector("[data-id='colorful-text'] pre").innerHTML;
      }
      function setText(message) {
        if(message === ''){
          message = 'Type Message Here';
        }
        document.querySelector("[data-id='colorful-text'] pre").innerHTML = message;
      }

       // Attach Listeners
      function addListenersForEditor(){
        // update text if user types in the textbox
        $textbox = document.querySelector("[data-id='controls'] textarea");
        $textbox.addEventListener('input', function(e){
          setText(this.value);
          setURI( this.value, getFontSize(), getFontFamily(), getColors() );
        });

        // font-size slider listener
        document.querySelector("[data-id='font-size-range']").addEventListener('input', function(e){
          setTextSize(this.value + 'px');
          setURI( getText(), this.value + 'px', getFontFamily(), getColors() );
        });

        // font-style listener
        document.querySelector("[data-id='font-family-selector']").addEventListener('input', function(e){
          setFontFamily(this.value);
          setURI( getText(), getFontSize(), this.value, getColors() );
        });
      }

      function getFontSize(){
        return document.querySelector("[data-id='font-size-range']").value + 'px';
      }
      function setTextSize(size){
        document.querySelector("[data-id='colorful-text'] pre").style.fontSize = size;
      }
      function getFontFamily(){
        return document.querySelector("[data-id='font-family-selector']").value;
      }
      function setFontFamily(style){
        if(style === '' || style === []) { return; }

        document.querySelector("[data-id='colorful-text'] pre").style.fontFamily = style;
      }

      // make page display text
        if(document.location.search === '') {
          // show page specific
          document.querySelector("[data-id='controls']").style.display = 'block';
          addListenersForEditor();
          document.querySelector("[data-id='colorful-text'] pre").style.fontFamily = getFontFamily();
          window.color_sequence = window.default_color_sequence;
        }
        else
        {
          // edit page specific
          var uri = decodeURI(document.location.search);

          var font_size = '';
          try{
            font_size = uri.match(/font-size=([^&]*)/)[1];
          }catch(e){
            font_size = getFontSize();
          }

          // get font-family from url
          var font_family = '';
          try{
            font_family = uri.match(/font-family=([^&]*)&/)[1];
          }catch(e){
            font_family = getFontFamily();
          }

          // get colors from url
          try{
            window.color_sequence = decodeURI(uri.match(/color_sequence=([^&]*)/)[1]);
          }catch(e){
            window.color_sequence = default_color_sequence;
          }

          // get colors from url
          var message = '';
          try{
            message = decodeURI(document.location.search.match(/message=(.*)/)[1]);
          }catch(e){
            message = document.querySelector("textarea").getAttribute('placeholder');
          }

          setText( message, font_size, font_family );
          setTextSize(font_size)
          setFontFamily(font_family)
        }

      // color spinning animation
        var angle = 0;
        var $text = document.querySelector("[data-id='colorful-text'] pre");
        function changeAngle() {
          angle = (angle + 3) % 360;
          $text.style.background = 'linear-gradient(' + angle + 'deg,' + window.color_sequence + ')';
          $text.style.WebkitBackgroundClip = 'text';
          $text.style.WebkitTextFillColor = 'transparent';
        }
        window.startSpinning = function(){
          window.rainbowIntervalID = setInterval(changeAngle, 50);
        }
        window.stopSpinning = function(){
          clearInterval(window.rainbowIntervalID);
        }
        startSpinning();
    };
  </script>

  </body>
</html>
